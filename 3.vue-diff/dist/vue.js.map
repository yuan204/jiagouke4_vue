{"version":3,"file":"vue.js","sources":["../src/compiler/index.js","../src/observe/dep.js","../src/utils/nextTick.js","../src/observe/schedular.js","../src/observe/watcher.js","../src/vdom/index.js","../src/vdom/patch.js","../src/lifecycle.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // 用来描述标签的\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的  捕获的是结束标签的标签名\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的  分组1 拿到的是属性名  , 分组3 ，4， 5 拿到的是key对应的值\n\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的    />    >   \nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g // 匹配双花括号中间单的内容\n\nfunction parserHTML(html) {\n    function advance(n) {\n        html = html.substring(n); // 每次根据传入的长度截取html\n    }\n    let root; // 树的操作 ，需要根据开始标签和结束标签产生一个树\n    // 如何构建树的父子关系\n    let stack = [];\n\n    function createASTElement(tagName, attrs) {\n        return {\n            tag: tagName,\n            attrs,\n            children: [],\n            parent: null,\n            type: 1\n        }\n    }\n\n    function start(tagName, attrs) {\n        let element = createASTElement(tagName, attrs);\n        if (root == null) {\n            root = element;\n        }\n        let parent = stack[stack.length - 1]; // 取到栈中的最后一个\n        if (parent) {\n            element.parent = parent; // 让这个元素记住自己的父亲是谁\n            parent.children.push(element) // 让父亲记住儿子是谁\n        }\n        stack.push(element); // 将元素放到栈中\n    }\n\n    function end(tagName) {\n        stack.pop();\n    }\n\n    function chars(text) {\n        text = text.replace(/\\s/g, '');\n        if (text) {\n            let parent = stack[stack.length - 1];\n            parent.children.push({\n                type: 3,\n                text\n            })\n        }\n    }\n    //  ast 描述的是语法本身 ，语法中没有的，不会被描述出来  虚拟dom 是描述真实dom的可以自己增添属性\n    while (html) { // 一个个字符来解析将结果抛出去\n        let textEnd = html.indexOf('<');\n        if (textEnd === 0) {\n            const startTagMatch = parseStartTag(); // 解析开始标签  {tag:'div',attrs:[{name:\"id\",value:\"app\"}]}\n            if (startTagMatch) {\n                start(startTagMatch.tagName, startTagMatch.attrs);\n                continue\n            }\n            let matches;\n            if (matches = html.match(endTag)) { // <div>    </div>  不是开始就会走道结束\n                end(matches[1]);\n                advance(matches[0].length);\n                continue\n            }\n        }\n        let text;\n        if (textEnd >= 0) {\n            text = html.substring(0, textEnd)\n        }\n        if (text) {\n            advance(text.length);\n            chars(text);\n        }\n    }\n\n    function parseStartTag() {\n        const matches = html.match(startTagOpen);\n        if (matches) {\n            const match = {\n                tagName: matches[1],\n                attrs: []\n            }\n            advance(matches[0].length);\n            // 继续解析开始标签的属性 \n            let end, attr\n            while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) { // 只要没有匹配到结束标签就一直匹配\n                match.attrs.push({ name: attr[1], value: attr[3] || attr[4] || attr[5] || true });\n                advance(attr[0].length); // 解析一个属性删除一个\n            }\n            if (end) {\n                advance(end[0].length);\n                return match;\n            }\n        }\n    }\n    return root;\n}\n\nfunction genProps(attrs) {\n    let str = '';\n    for (let i = 0; i < attrs.length; i++) {\n        let attr = attrs[i];\n        // style=\"color:red;background:blue\"\n        if (attr.name === 'style') { // style=\"{color:red,background:blue}\"\n            let obj = {}\n            attr.value.split(';').reduce((memo, current) => {\n                let [key, value] = current.split(':')\n                memo[key] = value;\n                return memo;\n            }, obj);\n            attr.value = obj;\n        }\n\n        // 特殊的属性 style\n        str += `${attr.name}:${JSON.stringify(attr.value)},`\n    }\n    return `{${str.slice(0,-1)}}`\n}\n\nfunction gen(node) {\n    if (node.type === 1) {\n        return genCode(node)\n    } else {\n        let text = node.text;\n        if (!defaultTagRE.test(text)) {\n            return `_v(${JSON.stringify(text)})` // 不带表达式的\n        } else {\n            let tokens = [];\n            let match;\n            // exec 遇到全局匹配会有 lastIndex问题 每次匹配前需要将lastIndex 置为0\n            let startIndex = defaultTagRE.lastIndex = 0; // 自动会变 ，每次用的时候置为0\n            while (match = defaultTagRE.exec(text)) {\n                let endIndex = match.index; // 匹配到索引    abc {{ aa }} {{bb}} cd\n\n                if (endIndex > startIndex) {\n                    tokens.push(JSON.stringify(text.slice(startIndex, endIndex)));\n                }\n                tokens.push(`_s(${match[1].trim()})`);\n                startIndex = endIndex + match[0].length\n            }\n            if (startIndex < text.length) { // 最后的尾巴放进去\n                tokens.push(JSON.stringify(text.slice(startIndex)));\n            }\n            return `_v(${tokens.join('+')})` // 最后将动态数据 和非动态的拼接在一起\n        }\n    }\n}\n\nfunction genChildren(ast) {\n    const children = ast.children;\n    return children.map(child => gen(child)).join(',')\n}\n\nfunction genCode(ast) {\n    // 字符串拼接 拼接成我想要的就可以 \n\n    let code;\n    code = `_c(\"${ast.tag}\",${\n        ast.attrs.length? genProps(ast.attrs) : \"undefined\"\n    }${\n        ast.children ? ','+genChildren(ast) :''\n    })`; // _c('div',{classNanem:\"xxx\"},createTextVnode('hello world'))\n    return code;\n}\n// 将模板变成render函数 通过 with + new Function的方式让字符串变成js语法来执行\nexport function compileToFunction(template) {\n    let ast = parserHTML(template)\n\n    // 通过ast语法树转化成render函数\n    let code = genCode(ast);\n    const render = new Function(`with(this){return ${code}}`); // 将字符串变成了函数\n    return render;\n}\n// 4.12继续\n\n// 将template转化成ast语法树 -》 再讲语法树转化成一个字符串拼接在一起\n// ast 是用来描述语言本身的\n// vdom 描述dom元素的","let did = 0;\nclass Dep{ // 作用是收集watcher\n    constructor(){\n        this.id = did++;\n        this.watchers = []\n    }\n    depend(){ // watcher 和 dep是一个多对多的关系\n        Dep.target.addDep(this); // 让watcher去记录dep\n    }\n    addWatcher(watcher){\n        this.watchers.push(watcher)\n    }\n    notify(){\n        this.watchers.forEach(watcher=>watcher.update());\n    }\n}\nDep.target = null; // 描述当前watcher是谁的\nexport default Dep","let callbacks = [];\nlet waiting = false;\nfunction flushCallbacks(){\n    callbacks.forEach(cb=>cb());\n    callbacks = [];\n    waiting = false;\n}\n\n// 异步任务分为 两种 宏任务、微任务\n// 宏任务 setTimeout setImmediate(ie下支持性能优于setTimeout)\n// 微任务 promise.then mutationObserver\n// vue在更新的时候希望尽快的更新页面 promise.then  mutationObserver  setImmediate setTimeout\n// vue3不在考虑兼容性问题了 所以后续vue3中直接使用promise.then\n\n\nlet timeFunc;\nif(typeof Promise !== 'undefined'){\n    let p = Promise.resolve();\n    timeFunc = ()=>{\n        p.then(flushCallbacks)\n    }\n}else if(typeof MutationObserver !== 'undefined'){\n    let observer = new MutationObserver(flushCallbacks); // mutationObserver放的回调是异步执行的\n    let textNode = document.createTextNode(1) //. 文本节点内容先是1\n    observer.observe(textNode,{characterData:true});\n    timeFunc = () =>{\n        textNode.textContent = 2; // 改成了2  就会触发更新了\n    }\n}else if(typeof setImmediate !== 'undefined'){\n    timeFunc = ()=>{\n        setImmediate(flushCallbacks)\n    }\n}else {\n    timeFunc = ()=>{\n        setTimeout(flushCallbacks,0)\n    }\n}\n\nexport function nextTick(cb){\n    callbacks.push(cb);\n    if(!waiting){\n        waiting = true\n        timeFunc();\n    }\n}\n","import { nextTick } from \"../utils/nextTick\";\nlet queue = [];\nlet has = {};\nlet pending = false;\nfunction flushSchedularQueue(){\n    queue.forEach(watcher=>watcher.run())\n    queue = [];\n    has = {};\n    pending = false\n}\nexport function queueWatcher(watcher){\n    let id = watcher.id;\n    if(has[id] == null){\n        queue.push(watcher)\n        has[id] = true;\n        if(!pending){\n            nextTick(() => { // 万一一个属性 对应多个更新，那么可能会开启多个定时器\n                flushSchedularQueue(); // 批处理操作 ， 防抖\n            });\n            pending = true;\n        }\n    }\n}","import Dep from \"./dep\";\nimport { queueWatcher } from \"./schedular\";\nlet wid = 0;\nclass Watcher{\n    constructor(vm,fn,cb,options){\n        this.vm = vm;\n        this.fn = fn;\n        this.cn = cb;\n        this.options = options\n        this.deps = [];\n        this.depsId = new Set()\n        this.id = wid++\n        this.get(); // 实现页面的渲染\n    }\n    get(){\n        // todo ....\n        Dep.target = this\n        this.fn(); // 去实例中取值  触发getter\n        Dep.target = null;\n        // 只有在渲染的时候才有Dep.target属性\n    }\n    addDep(dep){\n        let id = dep.id;// 获取收集器的id 做去重操作\n        if(!this.depsId.has(id)){\n            this.deps.push(dep)\n            this.depsId.add(id)\n            dep.addWatcher(this)\n        }\n    }\n    update(){\n        queueWatcher(this);\n    }\n    run(){\n        console.log('run')\n        this.get();\n    }\n}\n\n\n\n// 让属性记住对应的渲染函数，如果属性发生变化就调用对应的渲染函数\n\n// 我们给每个属性增加一个收集器， 通过收集器来收集watcher\n\n// 一个属性有一个dep -》 watcher？ 一个属性对应多个watcher\n// 一个watcher 对应多少个dep？ 一个watcher对应多个dep\n\n// 多对多\n\nexport default Watcher","export function createElement(vm, tag, data = {}, ...children) {\n    return vnode(vm,tag,data,children,data.key,null)\n}\n\nexport function createTextNode(vm,text) {\n    return vnode(vm,undefined,undefined,undefined,undefined,text)\n}\n\nfunction vnode(vm,tag,data,children,key,text){\n    return {\n        vm,\n        tag,\n        data,\n        children,\n        key,\n        text\n        // ...\n    }\n}","function isSameVnode(n1, n2) {\n    return n1.tag == n2.tag && n1.key === n2.key\n}\n\nexport function patch(oldVnode, vnode) { // oldVnode 可能是后续做虚拟节点的时候 是两个虚拟节点的比较\n\n    const isRealElement = oldVnode.nodeType; // 如果有说明他是一个dom元素\n\n    if (isRealElement) {\n        const oldElm = oldVnode;\n\n        // 需要获取父节点 将当前节点的下一个元素作为参照物 将他插入，之后删除老节点\n\n        const parentNode = oldElm.parentNode; // 父节点\n\n        let el = createElm(vnode); // 根据虚拟节点\n        parentNode.insertBefore(el, oldElm.nextSibling);\n        parentNode.removeChild(oldElm)\n        return el;\n    } else {\n        patchVnode(oldVnode, vnode)\n    }\n    // diff算法\n}\n\n\n\nexport function createElm(vnode) {\n    let { tag, data, children, text } = vnode;\n    if (typeof tag === 'string') { // 元素\n        vnode.el = document.createElement(tag); // 后续我们需要diff算法 拿虚拟节点比对后更新dom\n        children.forEach(child => {\n            vnode.el.appendChild(createElm(child)); // 递归渲染\n        })\n        // 样式类名....\n        updateProperties(vnode);\n    } else { // 文本\n        vnode.el = document.createTextNode(text);\n    }\n    return vnode.el; // 从根虚拟节点创建真实节点\n}\n\nfunction updateProperties(vnode, oldProps = {}) {\n    let newProps = vnode.data || {}; // 新props \n    // 老的props \n    // 属性的diff算法\n    let el = vnode.el;\n    // 比较sytle 特殊一些 需要看下样式\n    let oldStyle = oldProps.style || {};\n    let newStyle = newProps.style || {}\n    for (let key in oldStyle) {\n        if (!(key in newStyle)) {\n            el.style[key] = ''\n        }\n    }\n    for (let key in oldProps) {\n        if (!(key in newProps)) {\n            el.removeAttribute(key)\n        }\n    }\n    for (let key in newProps) {\n        if (key === 'style') {\n            for (let styleKey in newProps[key]) {\n                el.style[styleKey] = newProps[key][styleKey]\n            }\n        } else if (key === 'class') {\n            el.className = newProps[key];\n        } else {\n            el.setAttribute(key, newProps[key])\n        }\n    }\n}\n\n// 每次更新页面的话 dom结果是不会变的， 我调用render方法时，数据变化了会根据数据渲染成新的虚拟节点，用新的虚拟节点渲染dom\n\n\n\n\n\n\nfunction patchVnode(oldVnode, vnode) {\n    // case1: 前后两个虚拟节点不是相同节点直接替换掉即可\n    if (!isSameVnode(oldVnode, vnode)) {\n        return oldVnode.el.parentNode.replaceChild(createElm(vnode), oldVnode.el)\n    }\n    // 标签一样我就复用节点\n    let el = vnode.el = oldVnode.el\n    // case2：两个元素虚拟节点都是文本的情况下 用新文本换掉老的文本即可\n    if (!oldVnode.tag) { // 是文本\n        if (oldVnode.text !== vnode.text) {\n            return el.textContent = vnode.text\n        }\n    }\n    // case3: 两个都是标签 比较属性\n    updateProperties(vnode, oldVnode.data)\n\n    // case4: 比较儿子节点\n    // 一方有儿子 一方没儿子 \n    // 两方都有儿子 \n    let oldChildren = oldVnode.children || [];\n    let newChildren = vnode.children || [];\n\n    if (oldChildren.length > 0 && newChildren.length > 0) {\n        // diff算法是一层层的比较 不涉及到跨级比较\n        updateChildren(el, oldChildren, newChildren);\n    } else if (newChildren.length > 0) {\n        for (let i = 0; i < newChildren.length; i++) {\n            el.appendChild(createElm(newChildren[i]))\n        }\n    } else if (oldChildren.length > 0) {\n        el.innerHTML = ''; // 直接清除掉所有节点\n    }\n}\n\n\n\n\n\n\n\n// diff算法采用了双指针的方式进行比对，并且是O(n)\nfunction updateChildren(el, oldChildren, newChildren) {\n    // vue中创建了4个指针 分别指向 老孩子和新孩子的头尾\n    // 分别依次进行比较有一方先比较完毕就结束比较\n    let oldStartIndex = 0;\n    let oldEndIndex = oldChildren.length - 1;\n    let newStartIndex = 0;\n    let newEndIndex = newChildren.length - 1;\n\n    let oldStartVnode = oldChildren[0];\n    let oldEndVnode = oldChildren[oldEndIndex];\n    let newStartVnode = newChildren[0];\n    let newEndVnode = newChildren[newEndIndex];\n\n    // 有一方比完就停止  儿子的规模变大而变大 O(n)\n\n    function makeIndexByKey(children) {\n        return children.reduce((memo, current, index) => (memo[current.key] = index, memo), {})\n    }\n    let map = makeIndexByKey(oldChildren);\n    while (oldStartIndex <= oldEndIndex && newStartIndex <= newEndIndex) {\n        // 这里在优化dom的常见操作 向前追加 向后追加  尾部移动头部\n        // 复用节点\n        if (!oldStartVnode) {\n            oldStartVnode = oldChildren[++oldStartIndex]\n        } else if (!oldEndVnode) {\n            oldEndVnode = oldChildren[--oldEndIndex]\n        } else if (isSameVnode(oldStartVnode, newStartVnode)) { // 说明两个元素是同一个元素 要比较属性，和他的儿子\n            patchVnode(oldStartVnode, newStartVnode);\n            oldStartVnode = oldChildren[++oldStartIndex];\n            newStartVnode = newChildren[++newStartIndex];\n        } else if (isSameVnode(oldEndVnode, newEndVnode)) {\n            patchVnode(oldEndVnode, newEndVnode);\n            oldEndVnode = oldChildren[--oldEndIndex];\n            newEndVnode = newChildren[--newEndIndex];\n        } else if (isSameVnode(oldEndVnode, newStartVnode)) { // 尾头比对\n            patchVnode(oldEndVnode, newStartVnode);\n            el.insertBefore(oldEndVnode.el, oldStartVnode.el)\n            oldEndVnode = oldChildren[--oldEndIndex];\n            newStartVnode = newChildren[++newStartIndex]\n        } else if (isSameVnode(oldStartVnode, newEndVnode)) { // 头尾比对\n            patchVnode(oldStartVnode, newEndVnode);\n            el.insertBefore(oldStartVnode.el, oldEndVnode.el.nextSibling)\n            oldStartVnode = oldChildren[++oldStartIndex];\n            newEndVnode = newChildren[--newEndIndex]\n        }\n        // 会根据key进行diff算法 ， 所以在使用的时候如果列表是可操作的，尽量避开用index作为key\n        else {\n            // 乱序比对 我们需要尽可能找出能复用的元素出来\n            let moveIndex = map[newStartVnode.key];\n            if (moveIndex == undefined) {\n                // 不用复用直接创建插入即可\n                el.insertBefore(createElm(newStartVnode), oldStartVnode.el)\n            } else {\n                // 有的话直接移动老的节点\n                let moveVnode = oldChildren[moveIndex];\n                oldChildren[moveIndex] = undefined\n                el.insertBefore(moveVnode.el, oldStartVnode.el);\n                patchVnode(moveVnode, newStartVnode); // 比属性 比儿子\n            }\n            newStartVnode = newChildren[++newStartIndex]\n        }\n    }\n    if (newStartIndex <= newEndIndex) { // 将新增的直接插入\n        for (let i = newStartIndex; i <= newEndIndex; i++) {\n            // 可能是像前面添加 还有可能是像后添加\n            // el.appendChild(createElm(newChildren[i]))\n            let nextEle = newChildren[newEndIndex + 1] == null ? null : newChildren[newEndIndex + 1].el;\n\n            // nextEle 可能是null 可能是一个dom元素\n            el.insertBefore(createElm(newChildren[i]), nextEle); // 如果anchor参照物是null 会被变成appendChild\n        }\n    }\n    if (oldStartIndex <= oldEndIndex) { // 老的多余的元素删除掉即可\n        for (let i = oldStartIndex; i <= oldEndIndex; i++) {\n            if (oldChildren[i] !== undefined) {\n                el.removeChild(oldChildren[i].el)\n            }\n        }\n    }\n    // Vue3采用了最长递增子序列，找到最长不需要移动的序列，从而减少了移动操作\n\n}","import Watcher from \"./observe/watcher\"\nimport { createElement, createTextNode } from \"./vdom/index\"\nimport { patch } from \"./vdom/patch\"\n\n// 创造对应的虚拟节点 进行渲染\nexport function lifeCycleMixin(Vue) {\n    Vue.prototype._c = function() {\n        return createElement(this, ...arguments)\n    }\n    Vue.prototype._v = function() {\n        return createTextNode(this, ...arguments)\n    }\n    Vue.prototype._s = function(value) { // 将数据转化成字符串 因为使用的变量对应的结果可能是一个对象\n        if(typeof value === 'object' && value !== null){\n            return JSON.stringify(value)\n        }\n        return value;\n    }\n    Vue.prototype._render = function() {\n        const vm = this;\n        const render = vm.$options.render;\n        let vnode = render.call(vm); // _c( _s _v)  with(this)\n        return vnode;\n    }\n    Vue.prototype._update = function(vnode) { // 将虚拟节点变成真实节点\n        // 将vnode 渲染el元素中\n        const vm = this;\n        vm.$el = patch(vm.$el,vnode); // 可以初始化渲染， 后续更新也走这个patch方法\n    }\n}\n// 将模板变成ast -> render  -> render函数产生虚拟节点(数据得是渲染好的)---|\n\n\nexport function mountComponent(vm, el) {\n    // 实现页面的挂载流程\n    vm.$el = el;// 先将el挂载到实例上 \n    const updateComponent = () => {\n        // 需要调用生成的render函数 获取到虚拟节点  -> 生成真实的dom\n        vm._update(vm._render());\n    }\n\n    new Watcher(vm,updateComponent,()=>{\n        console.log('页面重新渲染 updated')\n    },true)\n    // updateComponent(); // 如果稍后数据变化 也调用这个函数重新执行 \n    // 观察者模式 + 依赖收集 + diff算法\n}\n\n","let oldArrayPrototype = Array.prototype;\n// arrayProptotype.__proto__ = Array.prototype;\n\nlet arrayPrototype = Object.create(oldArrayPrototype);\nlet methods = [\n    'push',\n    'pop',\n    'shift',\n    'unshift',\n    'reverse',\n    'sort',\n    'splice'\n]\nmethods.forEach(method => { // 用户调用push方法会先经历我自己重写的方法,之后调用数组原来的方法\n    arrayPrototype[method] = function(...args) {\n        let inserted;\n        let ob = this.__ob__;\n        switch (method) {\n            case 'push':\n            case 'unshift':\n                inserted = args; // 数组\n                break;\n            case 'splice': // arr.splice(1,1,xxx)\n                inserted = args.slice(2); // 接去掉前两个参数\n            default:\n                break\n        }\n        if (inserted) {\n            // 对新增的数据再次进行观测\n            ob.observeArray(inserted)\n        }\n        let result =  oldArrayPrototype[method].call(this, ...args)\n        // 更新页面...  靠的都是watcher数组并没有收集watcher\n        ob.dep.notify();\n        return result\n    }\n})\nexport default arrayPrototype\n\n","import arrayPrototype from \"./array\";\r\nimport Dep from \"./dep\";\r\n\r\n// 1.给每个对象和数组也增加dep属性\r\n// 2.当页面取值的时候回执行get方法， 拿到刚才新增的dep属性，让她记住这个watcher\r\n// 3.稍后数据变化 触发当前数组的dep中存放的watcher去更新\r\n\r\nclass Observer{\r\n    constructor(data){ // data 的类型是对象也可能是数组\r\n        // 如果是数组的话也是用defineProperty会浪费很多性能 很少用户会通过arr[878] = 123\r\n        // vue3中的polyfill 直接就给数组做代理了\r\n         // 改写数组的方法，如果用户调用了可以改写数组方法的api 那么我就去劫持这个方法\r\n        // 变异方法 push pop shift unshift reverse sort splice \r\n\r\n        this.dep = new Dep(); // 给所有的对象都增加一个dep, 后续我们会给对象增添新的属性也期望能实现更新\r\n        Object.defineProperty(data,'__ob__',{\r\n            value:this,\r\n            enumerable:false\r\n        })\r\n         // 如果有__ob__属性 说明被观测过了\r\n        // 修改数组的索引和长度是无法更新视图的\r\n        if(Array.isArray(data)){\r\n            // 需要重写这7个方法\r\n            data.__proto__ = arrayPrototype; \r\n            // 直接将属性赋值给这个对象\r\n            // 如果数组里面放的是对象类型 我期望他也会被变成响应式的\r\n            this.observeArray(data);\r\n        }else{\r\n            this.walk(data)\r\n        }\r\n    }\r\n    observeArray(data){\r\n        data.forEach(item=> observe(item)); //如果是对象我才进行观测了  \r\n    }\r\n    walk(data){ // 循环对象 尽量不用for in （会遍历原型链）\r\n        let keys = Object.keys(data); // [0,1,2]\r\n        keys.forEach(key=> { //没有重写数组里的每一项\r\n            defineReactive(data,key,data[key])\r\n        })\r\n    }\r\n}\r\n// 性能不好的原因在于 所有的属性都被重新定义了一遍\r\n// 一上来需要将对象深度代理 性能差\r\nfunction dependArray(value){\r\n    for(let i = 0; i < value.length;i++){\r\n        let temp = value[i];\r\n        temp.__ob__ && temp.__ob__.dep.depend(); // 让数组中的对象类型做依赖收集  [[[]]]\r\n        if(Array.isArray(temp)){\r\n            dependArray(temp)\r\n        }\r\n    }\r\n}\r\nfunction defineReactive(data,key,value){ //  闭包\r\n    // 属性会全部被重写增加了get和set\r\n    let dep = new Dep()\r\n    let childOb = observe(value); // 递归代理属性 , childOb就是当前的实例\r\n    Object.defineProperty(data,key,{\r\n        get(){ // vm.xxx\r\n            if(Dep.target){\r\n               dep.depend()  // 依赖收集 要将属性收集对应的watcher\r\n               if(childOb){\r\n                childOb.dep.depend(); // 让数组和对象也记录一下渲染watcher\r\n                if(Array.isArray(value)){\r\n                    dependArray(value);\r\n                }\r\n               }\r\n            }\r\n            return value;\r\n        },\r\n        set(newValue){ // vm.xxx = {a:1} 赋值一个对象的话 也可以实现响应式数据\r\n            if(newValue === value) return\r\n            childOb = observe(newValue)\r\n            value = newValue;\r\n            dep.notify(); // 通知依赖的watcher去重新渲染\r\n        }\r\n    })\r\n}\r\nexport function observe(data) {\r\n    if(typeof data !== 'object' || data == null){\r\n        return ; // 如果不是对象类型，那么不要做任何处理\r\n    }\r\n    if(data.__ob__){\r\n        // 说明这个属性已经被代理过了\r\n        return data\r\n    }\r\n\r\n    // 我稍后要区分 如果一个对象已经被观测了，就不要再次被观测了\r\n    // __ob__ 标识是否有被观测过\r\n\r\n    return new Observer(data)\r\n};\r\n\r\n\r\n// 每个类头有一个prototype 指向了一个公共的空间\r\n// 每个实例可以通过__proto__ 找到所属类的prototype对应的内容\r\n\r\n\r\n\r\n// 1.在Vue2中对象的响应式原理，就是给每个属性增加get和set，而且是递归操作 （用户在写代码的时候尽量不要把所有的属性都放在data中，层次尽可能不要太深）, 赋值一个新对象也会被变成响应式的\r\n// 2.数组没有使用defineProperty 采用的是函数劫持创造一个新的原型重写了这个原型的7个方法，用户在调用的时候采用的是这7个方法。我们增加了逻辑如果是新增的数据会再次被劫持 。 最终调用数组的原有方法 （注意数字的索引和长度没有被监控）  数组中对象类型会被进行响应式处理","import { observe } from \"./observe/index\";\r\n\r\nexport function initState(vm) {\r\n    const options = vm.$options\r\n\r\n    // 后续实现计算属性 、 watcher 、 props 、methods\r\n    if (options.data) {\r\n        initData(vm);\r\n    }\r\n}\r\n\r\nfunction proxy(vm, source, key) {\r\n    Object.defineProperty(vm, key, {\r\n        get() {\r\n            return vm[source][key]\r\n        },\r\n        set(newValue) {\r\n            vm[source][key] = newValue;\r\n        }\r\n    })\r\n}\r\n\r\nfunction initData(vm) {\r\n    let data = vm.$options.data;\r\n    // 如果是函数就拿到函数的返回值 否则就直接采用data作为数据源\r\n    data = vm._data = typeof data === 'function' ? data.call(vm) : data\r\n\r\n    // 属性劫持 采用defineProperty将所有的属性进行劫持\r\n\r\n    // 我期望用户可以直接通过 vm.xxx 获取值， 也可以这样取值 vm._data.xxx\r\n    for (let key in data) {\r\n        proxy(vm, '_data', key)\r\n    }\r\n    observe(data)\r\n}","import { compileToFunction } from \"./compiler/index\";\r\nimport { mountComponent } from \"./lifecycle\";\r\nimport { initState } from \"./state\";\r\n\r\nexport default function initMixin(Vue) {\r\n    Vue.prototype._init = function(options) {\r\n        const vm = this;\r\n        vm.$options = options // 所有后续的扩展方法都有一个$options选项可以获取用户的所有选项\r\n        // 对于实例的数据源 props data methods computed watch\r\n        // props data\r\n        initState(vm);\r\n        // vue中会判断如果是$开头的属性不会被变成响应式数据\r\n\r\n\r\n\r\n        // 状态初始化完毕后需要进行页面挂载\r\n        if (vm.$options.el) { // el 属性 和直接调用$mount是一样的\r\n            vm.$mount(vm.$options.el)\r\n        }\r\n    }\r\n    Vue.prototype.$mount = function(el) {\r\n        const vm = this;\r\n        el = document.querySelector(el);\r\n        const options = vm.$options;\r\n        if (!options.render) {\r\n            let template = options.template;\r\n            if (!template) {\r\n                template = el.outerHTML\r\n            }\r\n            // 将template变成render函数\r\n\r\n            // 创建render函数 -》 虚拟dom  -》 渲染真实dom\r\n\r\n            const render =  compileToFunction(template); // 开始编译\r\n            options.render = render;\r\n        }\r\n        mountComponent(vm,el)// 一定存在了\r\n        console.log(options.render.toString())\r\n    }\r\n    // diff算法 主要是两个虚拟节点的比对  我们需要根据模板渲染出一个render函数，render函数可以返回一个虚拟节点 ,数据更新了重新调用render函数 可以再返回一个虚拟节点，\r\n}\r\n\r\n\r\n","// 整个自己编写的Vue的入口\n\n\nimport initMixin from \"./init\"\nimport { lifeCycleMixin } from \"./lifecycle\";\nimport { nextTick } from \"./utils/nextTick\";\n\n// es6的类 要求所有的扩展都在类的内部来进行扩展\n\nfunction Vue(options) {\n    this._init(options);\n}\ninitMixin(Vue); // 后续在扩展都可以采用这种方式\nlifeCycleMixin(Vue)\n\n\n\nVue.prototype.$nextTick = nextTick\n\n// 给Vue添加原型方法我们通过文件的方式来添加，防止所有的功能都在一个文件中来处理\n\n// import { compileToFunction } from \"./compiler/index\";\n// import { createElm, patch } from \"./vdom/patch\";\n// let vm1 = new Vue({\n//     data: {\n//         name: 'zf',\n//         age: 12\n//     },\n// });\n// let template = `<div >\n//     <li key=\"A\">A</li>\n//     <li key=\"B\">B</li>\n//     <li key=\"C\">C</li>\n//     <li key=\"D\">D</li>\n// </div>`\n// let render = compileToFunction(template);\n// let oldVnode = render.call(vm1);\n// let ele = createElm(oldVnode);\n// document.body.appendChild(ele); // 就让虚拟节点和真实节点做了映射\n\n// // diff算法的比对是平级比对\n// // 比对的时候 主要比对标签名和key 来判断是不是同一个元素 ，如果标签和key 都一样说明两个元素是同一个元素\n// let vm2 = new Vue({});\n// let newTemplate = `<div>\n//     <li key=\"M\">M</li>\n//     <li key=\"Q\">Q</li>\n//     <li key=\"D\">D</li>\n//     <li key=\"E\">E</li>\n//     <li key=\"F\">F</li>\n// </div>`\n// let newRender = compileToFunction(newTemplate);\n// let newVnode = newRender.call(vm2);\n// setTimeout(() => {\n//     patch(oldVnode, newVnode)\n\n// }, 2000);\n\n\n\n\n\nexport default Vue"],"names":["ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","defaultTagRE","parserHTML","html","advance","n","substring","root","stack","createASTElement","tagName","attrs","tag","children","parent","type","start","element","length","push","end","pop","chars","text","replace","textEnd","indexOf","startTagMatch","parseStartTag","matches","match","attr","name","value","genProps","str","i","obj","split","reduce","memo","current","key","JSON","stringify","slice","gen","node","genCode","test","tokens","startIndex","lastIndex","exec","endIndex","index","trim","join","genChildren","ast","map","child","code","compileToFunction","template","render","Function","did","Dep","id","watchers","target","addDep","watcher","forEach","update","callbacks","waiting","flushCallbacks","cb","timeFunc","Promise","p","resolve","then","MutationObserver","observer","textNode","document","createTextNode","observe","characterData","textContent","setImmediate","setTimeout","nextTick","queue","has","pending","flushSchedularQueue","run","queueWatcher","wid","Watcher","vm","fn","options","cn","deps","depsId","Set","get","dep","add","addWatcher","console","log","createElement","data","vnode","undefined","isSameVnode","n1","n2","patch","oldVnode","isRealElement","nodeType","oldElm","parentNode","el","createElm","insertBefore","nextSibling","removeChild","patchVnode","appendChild","updateProperties","oldProps","newProps","oldStyle","style","newStyle","removeAttribute","styleKey","className","setAttribute","replaceChild","oldChildren","newChildren","updateChildren","innerHTML","oldStartIndex","oldEndIndex","newStartIndex","newEndIndex","oldStartVnode","oldEndVnode","newStartVnode","newEndVnode","makeIndexByKey","moveIndex","moveVnode","nextEle","lifeCycleMixin","Vue","prototype","_c","arguments","_v","_s","_render","$options","call","_update","$el","mountComponent","updateComponent","oldArrayPrototype","Array","arrayPrototype","Object","create","methods","method","inserted","ob","__ob__","args","observeArray","result","notify","Observer","defineProperty","enumerable","isArray","__proto__","walk","item","keys","defineReactive","dependArray","temp","depend","childOb","set","newValue","initState","initData","proxy","source","_data","initMixin","_init","$mount","querySelector","outerHTML","toString","$nextTick"],"mappings":"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"}